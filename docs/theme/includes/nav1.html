<ul class="nav-list">
  {%- assign titled_pages = include.pages
        | where_exp:"item", "item.ept != nil" -%}
  
  {%- assign string_ordered_pages = titled_pages
        | where_exp:"item", "item.nav_order == nil" -%}
  {%- assign nav_ordered_pages = titled_pages
        | where_exp:"item", "item.nav_order != nil"  -%}

  {%- assign nav_ordered_groups = nav_ordered_pages
        | group_by_exp:"item", "item.nav_order | jsonify | slice: 0" -%}
  {%- assign number_ordered_pages = "" | split:"X" -%}
  {%- for group in nav_ordered_groups -%}
    {%- if group.name == '"' -%}
      {%- assign string_ordered_pages = string_ordered_pages | concat: group.items -%}
    {%- else -%}
      {%- assign number_ordered_pages = number_ordered_pages | concat: group.items -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- assign sorted_number_ordered_pages = number_ordered_pages | sort:"nav_order" -%}
  
  {%- assign string_ordered_groups = string_ordered_pages
        | group_by_exp:"item", "item.nav_order | default: item.title | append:''" -%}
  {%- if site.nav_sort == 'case_insensitive' -%}
    {%- assign sorted_string_ordered_groups = string_ordered_groups | sort_natural:"name" -%}
  {%- else -%}
    {%- assign sorted_string_ordered_groups = string_ordered_groups | sort:"name" -%}
  {%- endif -%}
  {%- assign sorted_string_ordered_pages = "" | split:"X" -%}
  {%- for group in sorted_string_ordered_groups -%}
    {%- assign sorted_string_ordered_pages = sorted_string_ordered_pages | concat: group.items -%}
  {%- endfor -%}

  {%- assign pages_list = sorted_number_ordered_pages | concat: sorted_string_ordered_pages -%}

  {%- for node in pages_list -%}
    {%- if node.parent == nil -%}
      {%- unless node.nav_exclude -%}
      {%- assign temp_page_version = page.url | split: '/' -%}
      {%- assign temp_node_url = node.url | split: '/' -%}
      {%- if temp_page_version[1] == temp_node_url[1] -%}
      <li class="nav-list-item{% if page.url == node.dir + node.filepath %} active{% endif %}">
        <a href="{{ node.dir + node.filepath | absolute_url }}" class="nav-list-link{% if page.url == node.url %} active{% endif %}">{{ node }}</a>
      </li>
      {%- endif -%}
      {%- endunless -%}
    {%- endif -%}
  {%- endfor -%}
</ul>
